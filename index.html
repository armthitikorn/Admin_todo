<script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabaseUrl = 'https://wzwyotzzxycqfwercakh.supabase.co';
    const supabaseKey = 'YOUR_ANON_KEY_HERE'; // ควรใช้ anon key เท่านั้น
    const supabase = createClient(supabaseUrl, supabaseKey);

    const loginForm = document.getElementById('loginForm');

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        try {
            const { data: authData, error: authError } = await supabase.auth.signInWithPassword({ email, password });

            if (authError) {
                alert(`เข้าสู่ระบบไม่สำเร็จ: ${authError.message}`);
                return;
            }

            // ตรวจสอบว่า email อยู่ในตาราง admins หรือไม่
            const { data: adminData, error: adminError } = await supabase
                .from('admins')
                .select('email')
                .eq('email', email)
                .single();

            if (adminError || !adminData) {
                await supabase.auth.signOut();
                alert('คุณไม่มีสิทธิ์เข้าถึงหน้านี้');
                return;
            }

            // ✅ redirect หลัง login สำเร็จ
            alert('เข้าสู่ระบบสำเร็จ! กำลังเปลี่ยนเส้นทาง...');
            setTimeout(() => {
                window.location.assign('dashboard.html');
            }, 500); // หน่วงเวลาเล็กน้อยเพื่อให้ alert แสดงก่อน redirect

        } catch (err) {
            console.error('เกิดข้อผิดพลาด:', err);
            alert('เกิดข้อผิดพลาดในการเข้าสู่ระบบ');
        }
    });
</script>
</body>
</html>

